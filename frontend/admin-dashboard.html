<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdPay - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: white;
        }
        
        /* Header */
        .header {
            background: #1a1a1a;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #FFD700;
        }
        
        .logo {
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logout-btn {
            background: #FFD700;
            color: black;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Dashboard Layout */
        .dashboard {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #1a1a1a;
            padding: 20px;
            border-right: 1px solid #333;
        }
        
        .menu-item {
            padding: 12px 15px;
            margin: 5px 0;
            background: #333;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .menu-item:hover, .menu-item.active {
            background: #FFD700;
            color: black;
        }
        
        /* Main Content */
        .content {
            flex: 1;
            padding: 20px;
        }
        
        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
        }
        
        .stat-card h3 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
        }
        
        /* Tabs */
        .tab-content {
            display: none;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        th {
            background: #333;
            color: #FFD700;
        }
        
        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        .btn-primary {
            background: #FFD700;
            color: black;
        }
        
        .btn-secondary {
            background: #333;
            color: white;
            border: 1px solid #555;
        }
        
        .btn-success {
            background: #10B981;
            color: white;
        }
        
        .btn-danger {
            background: #EF4444;
            color: white;
        }
        
        /* Forms */
        .form-group {
            margin: 15px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #FFD700;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            background: #333;
            border: 1px solid #555;
            border-radius: 5px;
            color: white;
        }
        
        /* Status Badges */
        .status {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active {
            background: #10B981;
            color: white;
        }
        
        .status-pending {
            background: #F59E0B;
            color: white;
        }
        
        .status-inactive {
            background: #EF4444;
            color: white;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 20px;
            color: #FFD700;
        }
        
        /* Message Box */
        .message {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .message-success {
            background: #10B981;
            color: white;
        }
        
        .message-error {
            background: #EF4444;
            color: white;
        }
        
        .message-info {
            background: #3B82F6;
            color: white;
        }
        
        /* Logout Modal */
        .logout-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            text-align: center;
        }
        
        .modal-buttons {
            margin-top: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #333;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">AdPay Admin Dashboard</div>
        <div class="admin-info">
            <span id="adminEmail">admin@adpay.com</span>
            <button class="logout-btn" onclick="showLogoutModal()">Logout</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="menu-item active" onclick="showTab('dashboard')">
                üìä Dashboard
            </div>
            <div class="menu-item" onclick="showTab('tokens')">
                üîë Generate Tokens
            </div>
            <div class="menu-item" onclick="showTab('users')">
                üë• Manage Users
            </div>
            <div class="menu-item" onclick="showTab('pending')">
                ‚è≥ Pending Activations
            </div>
            <div class="menu-item" onclick="showTab('withdrawals')">
                üí∞ Withdrawal Requests
            </div>
            <div class="menu-item" onclick="showTab('transactions')">
                üìã All Transactions
            </div>
        </div>

        <!-- Main Content -->
        <div class="content">
            <!-- Stats -->
            <div class="stats-cards">
                <div class="stat-card">
                    <h3>Total Users</h3>
                    <div class="stat-value" id="totalUsers">0</div>
                </div>
                <div class="stat-card">
                    <h3>Active Users</h3>
                    <div class="stat-value" id="activeUsers">0</div>
                </div>
                <div class="stat-card">
                    <h3>Pending Users</h3>
                    <div class="stat-value" id="pendingUsers">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Revenue</h3>
                    <div class="stat-value" id="totalRevenue">‚Ç¶0</div>
                </div>
            </div>

            <!-- Messages -->
            <div id="successMessage" class="message message-success"></div>
            <div id="errorMessage" class="message message-error"></div>
            <div id="infoMessage" class="message message-info"></div>

            <!-- Tab: Dashboard -->
            <div id="dashboard-tab" class="tab-content active">
                <h2>üìä Quick Actions</h2>
                <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showTab('tokens')">
                        üîë Generate New Tokens
                    </button>
                    <button class="btn btn-primary" onclick="showTab('pending')">
                        ‚è≥ Check Pending Users
                    </button>
                    <button class="btn btn-primary" onclick="showTab('withdrawals')">
                        üí∞ Process Withdrawals
                    </button>
                    <button class="btn btn-secondary" onclick="refreshAllData()">
                        üîÑ Refresh All Data
                    </button>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Recent Activity</h3>
                    <div id="recentActivity" class="loading">
                        Loading recent activity...
                    </div>
                </div>
            </div>

            <!-- Tab: Generate Tokens -->
            <div id="tokens-tab" class="tab-content">
                <h2>üîë Generate Registration Tokens</h2>
                
                <div class="form-group">
                    <label>Select Plan Type:</label>
                    <select id="tokenPlan">
                        <option value="basic">Basic (‚Ç¶3,000)</option>
                        <option value="premium">Premium (‚Ç¶5,000)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Number of Tokens:</label>
                    <input type="number" id="tokenQuantity" value="1" min="1" max="100">
                </div>
                
                <button class="btn btn-primary" onclick="generateTokens()">
                    Generate Tokens
                </button>
                
                <div id="generatedTokens" style="margin-top: 30px; display: none;">
                    <h3>üéâ Generated Tokens:</h3>
                    <div id="tokenList" class="loading">Generating tokens...</div>
                    <button class="btn btn-secondary" onclick="copyAllTokens()">
                        üìã Copy All Tokens
                    </button>
                    <button class="btn btn-secondary" onclick="printTokens()">
                        üñ®Ô∏è Print Tokens
                    </button>
                </div>
            </div>

            <!-- Tab: Manage Users -->
            <div id="users-tab" class="tab-content">
                <h2>üë• All Users</h2>
                <div style="margin: 20px 0;">
                    <button class="btn btn-secondary" onclick="loadAllUsers()">
                        üîÑ Refresh Users
                    </button>
                </div>
                <div id="usersList" class="loading">
                    Loading users...
                </div>
            </div>

            <!-- Tab: Pending Activations -->
            <div id="pending-tab" class="tab-content">
                <h2>‚è≥ Users Pending Activation</h2>
                <p>Users who have registered but not paid/activated</p>
                <button class="btn btn-secondary" onclick="loadPendingUsers()" style="margin-bottom: 15px;">
                    üîÑ Refresh Pending Users
                </button>
                <div id="pendingUsersList" class="loading">
                    Loading pending users...
                </div>
            </div>

            <!-- Tab: Withdrawal Requests -->
            <div id="withdrawals-tab" class="tab-content">
                <h2>üí∞ Withdrawal Requests</h2>
                <div id="withdrawalsList" class="loading">
                    Loading withdrawal requests...
                </div>
            </div>

            <!-- Tab: All Transactions -->
            <div id="transactions-tab" class="tab-content">
                <h2>üìã All Transactions</h2>
                <div style="margin: 20px 0;">
                    <button class="btn btn-secondary" onclick="loadTransactions()">
                        üîÑ Refresh Transactions
                    </button>
                </div>
                <div id="transactionsList" class="loading">
                    Loading transactions...
                </div>
            </div>
        </div>
    </div>

    <!-- Logout Modal -->
    <div id="logoutModal" class="logout-modal">
        <div class="modal-content">
            <h2>Logout Confirmation</h2>
            <p>Are you sure you want to logout?</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="logout()">Yes, Logout</button>
                <button class="btn btn-secondary" onclick="hideLogoutModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // üî• CHANGE THIS TO YOUR VERCEL URL:
        const API_BASE = 'https://adpay-rho.vercel.app/api';
        let adminToken = '';

        // Check if admin is logged in
        window.onload = function() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            if (!isLoggedIn || isLoggedIn !== 'true') {
                window.location.href = 'admin-login.html';
                return;
            }
            
            // Show admin email
            const adminEmail = localStorage.getItem('adminEmail') || 'admin@adpay.com';
            document.getElementById('adminEmail').textContent = adminEmail;
            
            // First admin login to get token
            adminLogin().then(() => {
                loadDashboardStats();
                loadRecentActivity();
            });
        };

        // Show messages
        function showMessage(type, text, duration = 5000) {
            const element = document.getElementById(type + 'Message');
            element.textContent = text;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, duration);
        }

        // Tab Navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected tab
            const tab = document.getElementById(tabName + '-tab');
            if (tab) {
                tab.classList.add('active');
            }
            
            // Highlight menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                if (item.textContent.includes(getTabTitle(tabName))) {
                    item.classList.add('active');
                }
            });
            
            // Load data for the tab
            switch(tabName) {
                case 'dashboard':
                    loadDashboardStats();
                    loadRecentActivity();
                    break;
                case 'users':
                    loadAllUsers();
                    break;
                case 'pending':
                    loadPendingUsers();
                    break;
                case 'withdrawals':
                    loadWithdrawals();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
            }
        }

        function getTabTitle(tabName) {
            const titles = {
                'dashboard': 'üìä Dashboard',
                'tokens': 'üîë Generate Tokens',
                'users': 'üë• Manage Users',
                'pending': '‚è≥ Pending Activations',
                'withdrawals': 'üí∞ Withdrawal Requests',
                'transactions': 'üìã All Transactions'
            };
            return titles[tabName] || '';
        }

        // Logout Functions
        function showLogoutModal() {
            document.getElementById('logoutModal').style.display = 'flex';
        }

        function hideLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminEmail');
            window.location.href = 'admin-login.html';
        }

        // üî• REAL API FUNCTIONS

        // 1. Admin Login
        async function adminLogin() {
            try {
                const response = await fetch(`${API_BASE}/admin/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@adpay.com',
                        password: 'admin123'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        adminToken = data.data.token || 'admin-temporary-token';
                        showMessage('success', 'Admin login successful!', 3000);
                    }
                } else {
                    showMessage('error', 'Admin login failed. Using fallback mode.');
                    adminToken = 'admin-temporary-token';
                }
            } catch (error) {
                console.error('Admin login error:', error);
                showMessage('error', 'Cannot connect to server. Check internet connection.');
                adminToken = 'admin-temporary-token';
            }
        }

        // 2. Load Dashboard Stats
        async function loadDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/admin/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        const stats = data.data.stats;
                        document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                        document.getElementById('activeUsers').textContent = stats.activeUsers || 0;
                        document.getElementById('pendingUsers').textContent = stats.pendingUsers || 0;
                        document.getElementById('totalRevenue').textContent = `‚Ç¶${(stats.totalRevenue || 0).toLocaleString()}`;
                        return;
                    }
                }
            } catch (error) {
                console.log('Using fallback dashboard data');
            }
            
            // Fallback data
            document.getElementById('totalUsers').textContent = '0';
            document.getElementById('activeUsers').textContent = '0';
            document.getElementById('pendingUsers').textContent = '0';
            document.getElementById('totalRevenue').textContent = '‚Ç¶0';
        }

        // 3. Load Recent Activity
        async function loadRecentActivity() {
            try {
                const response = await fetch(`${API_BASE}/admin/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    let html = '<ul style="list-style: none; padding: 0;">';
                    
                    if (data.success && data.data.recentTransactions && data.data.recentTransactions.length > 0) {
                        data.data.recentTransactions.slice(0, 10).forEach(transaction => {
                            const date = new Date(transaction.createdAt).toLocaleDateString();
                            const user = transaction.user?.fullName || 'A User';
                            html += `<li style="padding: 8px; border-bottom: 1px solid #333;">
                                üìÖ ${date}: ${user} - ${transaction.description} (‚Ç¶${transaction.amount})
                            </li>`;
                        });
                    } else {
                        html += '<li>No recent activity yet</li>';
                    }
                    
                    html += '</ul>';
                    document.getElementById('recentActivity').innerHTML = html;
                }
            } catch (error) {
                document.getElementById('recentActivity').innerHTML = 
                    '<p>No recent activity found. Start by generating tokens!</p>';
            }
        }

        // 4. Generate Tokens - REAL API CALL
        async function generateTokens() {
            const plan = document.getElementById('tokenPlan').value;
            const quantity = parseInt(document.getElementById('tokenQuantity').value);
            
            if (!quantity || quantity < 1 || quantity > 100) {
                showMessage('error', 'Please enter a valid number (1-100)');
                return;
            }
            
            showMessage('info', 'Generating tokens...', 3000);
            
            try {
                const response = await fetch(`${API_BASE}/admin/tokens/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify({
                        userType: plan,
                        quantity: quantity
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success) {
                        let html = '<div style="background: #333; padding: 15px; border-radius: 5px; margin: 10px 0;">';
                        html += `<h4>${quantity} ${plan.toUpperCase()} Tokens Generated</h4>`;
                        html += '<table style="width: 100%; margin-top: 10px;">';
                        html += '<tr><th>Token Code</th><th>Plan</th><th>Price</th></tr>';
                        
                        data.data.tokens.forEach(token => {
                            html += `
                                <tr>
                                    <td><strong style="color: #FFD700;">${token.code}</strong></td>
                                    <td>${token.userType}</td>
                                    <td>‚Ç¶${token.price.toLocaleString()}</td>
                                </tr>
                            `;
                        });
                        html += '</table>';
                        html += '<p style="margin-top: 10px; color: #FFD700;">Share these tokens with new users for registration</p>';
                        html += '</div>';
                        
                        document.getElementById('tokenList').innerHTML = html;
                        document.getElementById('generatedTokens').style.display = 'block';
                        showMessage('success', `‚úÖ ${quantity} ${plan} tokens generated successfully!`);
                    } else {
                        showMessage('error', data.message || 'Failed to generate tokens');
                    }
                } else {
                    const error = await response.text();
                    showMessage('error', 'Server error: ' + error);
                }
            } catch (error) {
                console.error('Token generation error:', error);
                showMessage('error', 'Failed to connect to server. Check backend URL.');
            }
        }

        // 5. Load All Users
        async function loadAllUsers() {
            document.getElementById('usersList').innerHTML = '<div class="loading">Loading users...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/admin/users`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success && data.data.users && data.data.users.length > 0) {
                        let html = '<table>';
                        html += '<tr><th>Name</th><th>Email</th><th>Plan</th><th>Balance</th><th>Status</th><th>Joined</th><th>Actions</th></tr>';
                        
                        data.data.users.forEach(user => {
                            const statusClass = user.isActive ? 'status-active' : 'status-pending';
                            const statusText = user.isActive ? 'Active' : 'Pending';
                            const joinedDate = new Date(user.registrationDate).toLocaleDateString();
                            
                            html += `
                                <tr>
                                    <td>${user.fullName || 'N/A'}</td>
                                    <td>${user.email || 'N/A'}</td>
                                    <td>${user.userType || 'N/A'}</td>
                                    <td>‚Ç¶${(user.balance || 0).toLocaleString()}</td>
                                    <td><span class="status ${statusClass}">${statusText}</span></td>
                                    <td>${joinedDate}</td>
                                    <td>
                                        ${!user.isActive ? 
                                          `<button class="btn btn-success" onclick="activateUser('${user._id}', '${user.fullName}')">Activate</button>` : 
                                          '<button class="btn btn-secondary" disabled>Active</button>'}
                                    </td>
                                </tr>
                            `;
                        });
                        html += '</table>';
                        
                        document.getElementById('usersList').innerHTML = html;
                        showMessage('success', `Loaded ${data.data.users.length} users`);
                    } else {
                        document.getElementById('usersList').innerHTML = '<p>No users found yet. Generate tokens first!</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('usersList').innerHTML = 
                    '<p style="color: #EF4444;">‚ö†Ô∏è Cannot load users. Check backend connection.</p>';
            }
        }

        // 6. Load Pending Users
        async function loadPendingUsers() {
            document.getElementById('pendingUsersList').innerHTML = '<div class="loading">Loading pending users...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/admin/users/pending`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success && data.data.users && data.data.users.length > 0) {
                        let html = '<table>';
                        html += '<tr><th>Name</th><th>Email</th><th>Phone</th><th>Plan</th><th>Registered</th><th>Actions</th></tr>';
                        
                        data.data.users.forEach(user => {
                            const registered = new Date(user.registrationDate).toLocaleDateString();
                            const price = user.userType === 'premium' ? '‚Ç¶5,000' : '‚Ç¶3,000';
                            
                            html += `
                                <tr>
                                    <td>${user.fullName || 'N/A'}</td>
                                    <td>${user.email || 'N/A'}</td>
                                    <td>${user.phone || 'N/A'}</td>
                                    <td>${user.userType} (${price})</td>
                                    <td>${registered}</td>
                                    <td>
                                        <button class="btn btn-success" onclick="activatePendingUser('${user._id}', '${user.fullName}')">
                                            ‚úÖ Activate User
                                        </button>
                                        <button class="btn btn-secondary" onclick="sendReminder('${user.email}', '${user.fullName}')">
                                            üìß Remind
                                        </button>
                                    </td>
                                </tr>
                            `;
                        });
                        html += '</table>';
                        
                        document.getElementById('pendingUsersList').innerHTML = html;
                    } else {
                        document.getElementById('pendingUsersList').innerHTML = 
                            '<p>üéâ No pending users! All users are activated.</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading pending users:', error);
                document.getElementById('pendingUsersList').innerHTML = 
                    '<p>No pending users found or connection error.</p>';
            }
        }

        // 7. Activate Pending User
        async function activatePendingUser(userId, userName) {
            if (!confirm(`‚úÖ Activate ${userName}?\n\nConfirm you have received payment of ‚Ç¶${userName.includes('premium') ? '5,000' : '3,000'} before activating.`)) {
                return;
            }
            
            showMessage('info', `Activating ${userName}...`, 3000);
            
            try {
                const response = await fetch(`${API_BASE}/admin/users/${userId}/activate`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        showMessage('success', `‚úÖ ${userName} activated successfully!`);
                        // Refresh all data
                        setTimeout(() => {
                            loadPendingUsers();
                            loadAllUsers();
                            loadDashboardStats();
                        }, 1000);
                    } else {
                        showMessage('error', data.message || 'Activation failed');
                    }
                } else {
                    showMessage('error', 'Server error during activation');
                }
            } catch (error) {
                console.error('Activation error:', error);
                showMessage('error', 'Failed to activate user. Check connection.');
            }
        }

        // 8. Activate User (from all users list)
        async function activateUser(userId, userName) {
            activatePendingUser(userId, userName);
        }

        // 9. Load Withdrawals
        async function loadWithdrawals() {
            document.getElementById('withdrawalsList').innerHTML = 
                '<div class="loading">Checking withdrawal requests...</div>';
            
            // Since we don't have a withdrawals endpoint yet, show info
            setTimeout(() => {
                document.getElementById('withdrawalsList').innerHTML = 
                    '<div style="background: #333; padding: 20px; border-radius: 10px;">' +
                    '<h3 style="color: #FFD700;">üí∞ Withdrawal System</h3>' +
                    '<p>Users can request withdrawals on payment days (5th & 17th).</p>' +
                    '<p><strong>Basic Users:</strong> ‚Ç¶5,000 minimum (5AM-8AM)</p>' +
                    '<p><strong>Premium Users:</strong> ‚Ç¶10,000 minimum (5AM-12PM)</p>' +
                    '<p>Check the "Manage Users" tab to see user balances.</p>' +
                    '</div>';
            }, 1000);
        }

        // 10. Load Transactions
        async function loadTransactions() {
            document.getElementById('transactionsList').innerHTML = '<div class="loading">Loading transactions...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/admin/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success && data.data.recentTransactions && data.data.recentTransactions.length > 0) {
                        let html = '<table>';
                        html += '<tr><th>Date</th><th>User</th><th>Type</th><th>Amount</th><th>Status</th></tr>';
                        
                        data.data.recentTransactions.forEach(transaction => {
                            const date = new Date(transaction.createdAt).toLocaleDateString();
                            const user = transaction.user?.fullName || 'User';
                            const type = transaction.type.replace('_', ' ').toUpperCase();
                            const statusClass = transaction.status === 'completed' ? 'status-active' : 'status-pending';
                            
                            html += `
                                <tr>
                                    <td>${date}</td>
                                    <td>${user}</td>
                                    <td>${type}</td>
                                    <td>‚Ç¶${transaction.amount}</td>
                                    <td><span class="status ${statusClass}">${transaction.status}</span></td>
                                </tr>
                            `;
                        });
                        html += '</table>';
                        
                        document.getElementById('transactionsList').innerHTML = html;
                    } else {
                        document.getElementById('transactionsList').innerHTML = 
                            '<p>No transactions yet. Users will appear after registration.</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading transactions:', error);
                document.getElementById('transactionsList').innerHTML = 
                    '<p>Cannot load transactions. Check backend connection.</p>';
            }
        }

        // Utility Functions
        function copyAllTokens() {
            const tokenElements = document.querySelectorAll('#tokenList strong');
            if (tokenElements.length === 0) {
                showMessage('error', 'No tokens to copy');
                return;
            }
            
            const tokens = Array.from(tokenElements).map(el => el.textContent);
            const text = tokens.join('\n');
            
            navigator.clipboard.writeText(text).then(() => {
                showMessage('success', `${tokens.length} tokens copied to clipboard!`);
            }).catch(err => {
                showMessage('error', 'Failed to copy: ' + err);
            });
        }

        function printTokens() {
            const tokenContent = document.getElementById('tokenList').innerHTML;
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>AdPay Registration Tokens</title>
                        <style>
                            body { font-family: Arial; padding: 20px; }
                            h2 { color: #FFD700; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { border: 1px solid #333; padding: 10px; text-align: left; }
                            th { background: #f0f0f0; }
                        </style>
                    </head>
                    <body>
                        <h2>AdPay Registration Tokens</h2>
                        <p>Generated on: ${new Date().toLocaleString()}</p>
                        ${tokenContent}
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function sendReminder(email, name) {
            showMessage('info', `üìß Payment reminder sent to ${name} (${email})`);
            // In production, implement email sending
        }

        function refreshAllData() {
            showMessage('info', 'Refreshing all data...', 2000);
            loadDashboardStats();
            loadRecentActivity();
            loadAllUsers();
            loadPendingUsers();
            loadWithdrawals();
            loadTransactions();
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab && activeTab.id === 'dashboard-tab') {
                loadDashboardStats();
                loadRecentActivity();
            }
        }, 30000);
    </script>
</body>
</html>
