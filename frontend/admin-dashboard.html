<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdPay - Admin Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #000;
            color: white;
        }
        
        /* Header */
        .header {
            background: #1a1a1a;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #FFD700;
        }
        
        .logo {
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
        }
        
        .admin-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logout-btn {
            background: #FFD700;
            color: black;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* Dashboard Layout */
        .dashboard {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #1a1a1a;
            padding: 20px;
            border-right: 1px solid #333;
        }
        
        .menu-item {
            padding: 12px 15px;
            margin: 5px 0;
            background: #333;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .menu-item:hover, .menu-item.active {
            background: #FFD700;
            color: black;
        }
        
        /* Main Content */
        .content {
            flex: 1;
            padding: 20px;
        }
        
        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
        }
        
        .stat-card h3 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
        }
        
        /* Tabs */
        .tab-content {
            display: none;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        
        th {
            background: #333;
            color: #FFD700;
        }
        
        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        
        .btn-primary {
            background: #FFD700;
            color: black;
        }
        
        .btn-secondary {
            background: #333;
            color: white;
            border: 1px solid #555;
        }
        
        /* Forms */
        .form-group {
            margin: 15px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #FFD700;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            background: #333;
            border: 1px solid #555;
            border-radius: 5px;
            color: white;
        }
        
        /* Status Badges */
        .status {
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active {
            background: #10B981;
            color: white;
        }
        
        .status-pending {
            background: #F59E0B;
            color: white;
        }
        
        .status-inactive {
            background: #EF4444;
            color: white;
        }
        
        /* Logout Confirmation */
        .logout-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #FFD700;
            text-align: center;
        }
        
        .modal-buttons {
            margin-top: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #333;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo">AdPay Admin Dashboard</div>
        <div class="admin-info">
            <span id="adminEmail">admin@adpay.com</span>
            <button class="logout-btn" onclick="showLogoutModal()">Logout</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="menu-item active" onclick="showTab('dashboard')">
                üìä Dashboard
            </div>
            <div class="menu-item" onclick="showTab('tokens')">
                üîë Generate Tokens
            </div>
            <div class="menu-item" onclick="showTab('users')">
                üë• Manage Users
            </div>
            <div class="menu-item" onclick="showTab('pending')">
                ‚è≥ Pending Activations
            </div>
            <div class="menu-item" onclick="showTab('withdrawals')">
                üí∞ Withdrawal Requests
            </div>
            <div class="menu-item" onclick="showTab('transactions')">
                üìã All Transactions
            </div>
        </div>

        <!-- Main Content -->
        <div class="content">
            <!-- Stats -->
            <div class="stats-cards">
                <div class="stat-card">
                    <h3>Total Users</h3>
                    <div class="stat-value" id="totalUsers">0</div>
                </div>
                <div class="stat-card">
                    <h3>Active Users</h3>
                    <div class="stat-value" id="activeUsers">0</div>
                </div>
                <div class="stat-card">
                    <h3>Pending Users</h3>
                    <div class="stat-value" id="pendingUsers">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Revenue</h3>
                    <div class="stat-value" id="totalRevenue">‚Ç¶0</div>
                </div>
            </div>

            <!-- Tab: Dashboard -->
            <div id="dashboard-tab" class="tab-content active">
                <h2>üìä Quick Actions</h2>
                <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showTab('tokens')">
                        üîë Generate New Tokens
                    </button>
                    <button class="btn btn-primary" onclick="showTab('pending')">
                        ‚è≥ Check Pending Users
                    </button>
                    <button class="btn btn-primary" onclick="showTab('withdrawals')">
                        üí∞ Process Withdrawals
                    </button>
                    <button class="btn btn-secondary" onclick="refreshAllData()">
                        üîÑ Refresh All Data
                    </button>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3>Recent Activity</h3>
                    <div id="recentActivity">
                        <!-- Activity will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Tab: Generate Tokens -->
            <div id="tokens-tab" class="tab-content">
                <h2>üîë Generate Registration Tokens</h2>
                
                <div class="form-group">
                    <label>Select Plan Type:</label>
                    <select id="tokenPlan">
                        <option value="basic">Basic (‚Ç¶3,000)</option>
                        <option value="premium">Premium (‚Ç¶5,000)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Number of Tokens:</label>
                    <input type="number" id="tokenQuantity" value="1" min="1" max="100">
                </div>
                
                <button class="btn btn-primary" onclick="generateTokens()">
                    Generate Tokens
                </button>
                
                <div id="generatedTokens" style="margin-top: 30px; display: none;">
                    <h3>üéâ Generated Tokens:</h3>
                    <div id="tokenList"></div>
                    <button class="btn btn-secondary" onclick="copyAllTokens()">
                        üìã Copy All Tokens
                    </button>
                    <button class="btn btn-secondary" onclick="printTokens()">
                        üñ®Ô∏è Print Tokens
                    </button>
                </div>
            </div>

            <!-- Tab: Manage Users -->
            <div id="users-tab" class="tab-content">
                <h2>üë• All Users</h2>
                <div style="margin: 20px 0;">
                    <input type="text" id="searchUsers" placeholder="Search users by name, email, or referral code..." 
                           style="width: 100%; padding: 10px; background: #333; color: white; border: 1px solid #555; border-radius: 5px;">
                </div>
                <div id="usersList">
                    <!-- Users will be loaded here -->
                </div>
            </div>

            <!-- Tab: Pending Activations -->
            <div id="pending-tab" class="tab-content">
                <h2>‚è≥ Users Pending Activation</h2>
                <p>Users who have registered but not paid/activated</p>
                <div id="pendingUsersList">
                    <!-- Pending users will be loaded here -->
                </div>
            </div>

            <!-- Tab: Withdrawal Requests -->
            <div id="withdrawals-tab" class="tab-content">
                <h2>üí∞ Withdrawal Requests</h2>
                <div id="withdrawalsList">
                    <!-- Withdrawals will be loaded here -->
                </div>
            </div>

            <!-- Tab: All Transactions -->
            <div id="transactions-tab" class="tab-content">
                <h2>üìã All Transactions</h2>
                <div style="margin: 20px 0;">
                    <select id="filterType" onchange="loadTransactions()">
                        <option value="">All Types</option>
                        <option value="registration">Registration</option>
                        <option value="ad_view">Ad Views</option>
                        <option value="referral_bonus">Referral Bonus</option>
                        <option value="withdrawal">Withdrawals</option>
                    </select>
                </div>
                <div id="transactionsList">
                    <!-- Transactions will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Logout Modal -->
    <div id="logoutModal" class="logout-modal">
        <div class="modal-content">
            <h2>Logout Confirmation</h2>
            <p>Are you sure you want to logout?</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="logout()">Yes, Logout</button>
                <button class="btn btn-secondary" onclick="hideLogoutModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // API Base URL - CHANGE THIS TO YOUR VERCEL URL
        const API_BASE = 'https://your-backend-url.vercel.app/api';
        // Example: const API_BASE = 'https://adpay-backend.vercel.app/api';

        // Check if admin is logged in
        window.onload = function() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            if (!isLoggedIn || isLoggedIn !== 'true') {
                window.location.href = 'admin-login.html';
                return;
            }
            
            // Show admin email
            const adminEmail = localStorage.getItem('adminEmail') || 'admin@adpay.com';
            document.getElementById('adminEmail').textContent = adminEmail;
            
            // Load initial data
            loadDashboardStats();
            loadRecentActivity();
        };

        // Tab Navigation
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all menu items
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Highlight menu item
            document.querySelectorAll('.menu-item').forEach(item => {
                if (item.textContent.includes(getTabTitle(tabName))) {
                    item.classList.add('active');
                }
            });
            
            // Load data for the tab
            switch(tabName) {
                case 'dashboard':
                    loadDashboardStats();
                    loadRecentActivity();
                    break;
                case 'users':
                    loadAllUsers();
                    break;
                case 'pending':
                    loadPendingUsers();
                    break;
                case 'withdrawals':
                    loadWithdrawals();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
            }
        }

        function getTabTitle(tabName) {
            const titles = {
                'dashboard': 'üìä Dashboard',
                'tokens': 'üîë Generate Tokens',
                'users': 'üë• Manage Users',
                'pending': '‚è≥ Pending Activations',
                'withdrawals': 'üí∞ Withdrawal Requests',
                'transactions': 'üìã All Transactions'
            };
            return titles[tabName] || '';
        }

        // Logout Functions
        function showLogoutModal() {
            document.getElementById('logoutModal').style.display = 'flex';
        }

        function hideLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminEmail');
            window.location.href = 'admin-login.html';
        }

        // Data Loading Functions
        async function loadDashboardStats() {
            try {
                // In a real app, you would call your API
                // For now, we'll use mock data
                document.getElementById('totalUsers').textContent = '125';
                document.getElementById('activeUsers').textContent = '98';
                document.getElementById('pendingUsers').textContent = '27';
                document.getElementById('totalRevenue').textContent = '‚Ç¶375,000';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadRecentActivity() {
            const activities = [
                'John Doe registered as Premium user',
                'Jane Smith earned ‚Ç¶500 from ads',
                'Mike Johnson referred a new user',
                'Sarah Williams requested ‚Ç¶15,000 withdrawal',
                'Admin generated 5 Premium tokens'
            ];
            
            let html = '<ul>';
            activities.forEach(activity => {
                html += `<li style="padding: 8px; border-bottom: 1px solid #333;">${activity}</li>`;
            });
            html += '</ul>';
            
            document.getElementById('recentActivity').innerHTML = html;
        }

        // Generate Tokens
        async function generateTokens() {
            const plan = document.getElementById('tokenPlan').value;
            const quantity = document.getElementById('tokenQuantity').value;
            
            if (!quantity || quantity < 1) {
                alert('Please enter a valid number of tokens');
                return;
            }
            
            // In a real app, call your API
            // For now, generate mock tokens
            const tokens = [];
            const price = plan === 'premium' ? '‚Ç¶5,000' : '‚Ç¶3,000';
            
            for (let i = 0; i < quantity; i++) {
                const token = 'ADP' + Math.random().toString(36).substring(2, 10).toUpperCase();
                tokens.push({
                    code: token,
                    plan: plan,
                    price: price,
                    createdAt: new Date().toLocaleString()
                });
            }
            
            // Display tokens
            let html = '<table>';
            html += '<tr><th>Token Code</th><th>Plan</th><th>Price</th><th>Created</th></tr>';
            
            tokens.forEach(token => {
                html += `
                    <tr>
                        <td><strong>${token.code}</strong></td>
                        <td>${token.plan.toUpperCase()}</td>
                        <td>${token.price}</td>
                        <td>${token.createdAt}</td>
                    </tr>
                `;
            });
            html += '</table>';
            
            document.getElementById('tokenList').innerHTML = html;
            document.getElementById('generatedTokens').style.display = 'block';
            
            alert(`${quantity} ${plan} tokens generated successfully!`);
        }

        function copyAllTokens() {
            const tokenElements = document.querySelectorAll('#tokenList strong');
            const tokens = Array.from(tokenElements).map(el => el.textContent);
            const text = tokens.join('\n');
            
            navigator.clipboard.writeText(text).then(() => {
                alert('All tokens copied to clipboard!');
            });
        }

        function printTokens() {
            window.print();
        }

        // Load All Users
        async function loadAllUsers() {
            // Mock data - replace with API call
            const users = [
                { name: 'John Doe', email: 'john@email.com', type: 'Premium', balance: '‚Ç¶25,000', status: 'active', joined: '2024-01-15' },
                { name: 'Jane Smith', email: 'jane@email.com', type: 'Basic', balance: '‚Ç¶4,500', status: 'active', joined: '2024-01-20' },
                { name: 'Mike Johnson', email: 'mike@email.com', type: 'Premium', balance: '‚Ç¶12,000', status: 'active', joined: '2024-01-25' },
                { name: 'Sarah Williams', email: 'sarah@email.com', type: 'Basic', balance: '‚Ç¶3,200', status: 'pending', joined: '2024-01-28' }
            ];
            
            let html = '<table>';
            html += '<tr><th>Name</th><th>Email</th><th>Plan</th><th>Balance</th><th>Status</th><th>Joined</th><th>Actions</th></tr>';
            
            users.forEach(user => {
                const statusClass = user.status === 'active' ? 'status-active' : 
                                  user.status === 'pending' ? 'status-pending' : 'status-inactive';
                
                html += `
                    <tr>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.type}</td>
                        <td>${user.balance}</td>
                        <td><span class="status ${statusClass}">${user.status}</span></td>
                        <td>${user.joined}</td>
                        <td>
                            <button class="btn btn-secondary" onclick="viewUser('${user.email}')">View</button>
                            ${user.status === 'pending' ? 
                              `<button class="btn btn-primary" onclick="activateUser('${user.email}')">Activate</button>` : 
                              ''}
                        </td>
                    </tr>
                `;
            });
            html += '</table>';
            
            document.getElementById('usersList').innerHTML = html;
        }

        // Load Pending Users
        async function loadPendingUsers() {
            // Mock data - replace with API call
            const pendingUsers = [
                { id: 'U001', name: 'Sarah Williams', email: 'sarah@email.com', plan: 'Basic', amount: '‚Ç¶3,000', registered: '2024-01-28' },
                { id: 'U002', name: 'David Brown', email: 'david@email.com', plan: 'Premium', amount: '‚Ç¶5,000', registered: '2024-01-29' },
                { id: 'U003', name: 'Emma Wilson', email: 'emma@email.com', plan: 'Basic', amount: '‚Ç¶3,000', registered: '2024-01-30' }
            ];
            
            let html = '<table>';
            html += '<tr><th>User ID</th><th>Name</th><th>Email</th><th>Plan</th><th>Amount</th><th>Registered</th><th>Action</th></tr>';
            
            pendingUsers.forEach(user => {
                html += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.plan}</td>
                        <td>${user.amount}</td>
                        <td>${user.registered}</td>
                        <td>
                            <button class="btn btn-primary" onclick="activatePendingUser('${user.id}', '${user.email}')">
                                ‚úÖ Activate & Confirm Payment
                            </button>
                            <button class="btn btn-secondary" onclick="sendReminder('${user.email}')">
                                üìß Send Reminder
                            </button>
                        </td>
                    </tr>
                `;
            });
            html += '</table>';
            
            document.getElementById('pendingUsersList').innerHTML = html;
        }

        // Load Withdrawals
        async function loadWithdrawals() {
            // Mock data - replace with API call
            const withdrawals = [
                { id: 'W001', user: 'John Doe', amount: '‚Ç¶15,000', bank: 'GTBank', account: '0123456789', date: '2024-01-28', status: 'pending' },
                { id: 'W002', user: 'Mike Johnson', amount: '‚Ç¶10,000', bank: 'Access Bank', account: '9876543210', date: '2024-01-29', status: 'pending' },
                { id: 'W003', user: 'Jane Smith', amount: '‚Ç¶5,000', bank: 'Zenith Bank', account: '5555555555', date: '2024-01-27', status: 'paid' }
            ];
            
            let html = '<table>';
            html += '<tr><th>ID</th><th>User</th><th>Amount</th><th>Bank Details</th><th>Date</th><th>Status</th><th>Actions</th></tr>';
            
            withdrawals.forEach(w => {
                const statusClass = w.status === 'paid' ? 'status-active' : 'status-pending';
                
                html += `
                    <tr>
                        <td>${w.id}</td>
                        <td>${w.user}</td>
                        <td>${w.amount}</td>
                        <td>${w.bank} - ${w.account}</td>
                        <td>${w.date}</td>
                        <td><span class="status ${statusClass}">${w.status}</span></td>
                        <td>
                            ${w.status === 'pending' ? 
                              `<button class="btn btn-primary" onclick="markAsPaid('${w.id}')">Mark as Paid</button>` : 
                              `<button class="btn btn-secondary" disabled>Already Paid</button>`}
                            <button class="btn btn-secondary" onclick="viewReceipt('${w.id}')">View Details</button>
                        </td>
                    </tr>
                `;
            });
            html += '</table>';
            
            document.getElementById('withdrawalsList').innerHTML = html;
        }

        // Load Transactions
        async function loadTransactions() {
            // Mock data - replace with API call
            const transactions = [
                { id: 'T001', user: 'John Doe', type: 'registration', amount: '‚Ç¶5,000', date: '2024-01-15', status: 'completed' },
                { id: 'T002', user: 'Jane Smith', type: 'ad_view', amount: '‚Ç¶15', date: '2024-01-16', status: 'completed' },
                { id: 'T003', user: 'Mike Johnson', type: 'referral_bonus', amount: '‚Ç¶1,000', date: '2024-01-17', status: 'completed' },
                { id: 'T004', user: 'Sarah Williams', type: 'withdrawal', amount: '‚Ç¶15,000', date: '2024-01-18', status: 'pending' }
            ];
            
            const filter = document.getElementById('filterType').value;
            let filtered = transactions;
            
            if (filter) {
                filtered = transactions.filter(t => t.type === filter);
            }
            
            let html = '<table>';
            html += '<tr><th>ID</th><th>User</th><th>Type</th><th>Amount</th><th>Date</th><th>Status</th></tr>';
            
            filtered.forEach(t => {
                const statusClass = t.status === 'completed' ? 'status-active' : 'status-pending';
                
                html += `
                    <tr>
                        <td>${t.id}</td>
                        <td>${t.user}</td>
                        <td>${t.type.replace('_', ' ').toUpperCase()}</td>
                        <td>${t.amount}</td>
                        <td>${t.date}</td>
                        <td><span class="status ${statusClass}">${t.status}</span></td>
                    </tr>
                `;
            });
            html += '</table>';
            
            document.getElementById('transactionsList').innerHTML = html;
        }

        // Action Functions
        function activatePendingUser(userId, email) {
            if (confirm(`Activate user ${email} and confirm payment received?`)) {
                alert(`User ${email} activated successfully!`);
                // In real app, call API: POST /api/admin/users/{userId}/activate
                loadPendingUsers(); // Refresh list
                loadDashboardStats(); // Refresh stats
            }
        }

        function markAsPaid(withdrawalId) {
            if (confirm(`Mark withdrawal ${withdrawalId} as paid?`)) {
                alert(`Withdrawal ${withdrawalId} marked as paid!`);
                // In real app, call API to update withdrawal status
                loadWithdrawals(); // Refresh list
            }
        }

        function sendReminder(email) {
            alert(`Payment reminder sent to ${email}`);
            // In real app, implement email sending
        }

        function viewUser(email) {
            alert(`Viewing details for ${email}`);
            // In real app, show user details modal
        }

        function activateUser(email) {
            if (confirm(`Activate user ${email}?`)) {
                alert(`User ${email} activated!`);
                // In real app, call activation API
                loadAllUsers(); // Refresh list
            }
        }

        function viewReceipt(id) {
            alert(`Showing receipt for transaction ${id}`);
            // In real app, show transaction details
        }

        function refreshAllData() {
            loadDashboardStats();
            loadRecentActivity();
            loadAllUsers();
            loadPendingUsers();
            loadWithdrawals();
            loadTransactions();
            alert('All data refreshed!');
        }

        // Search functionality
        document.getElementById('searchUsers').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            // Implement search logic here
        });
    </script>
</body>
</html>
